
machine:
  node:
    version: 5.10.1

dependencies:
  cache_directories:
    - ~/nvm/versions/node/v5.10.1
  pre:
    - '[[ "$(npm --version)" = "$(cat .npm-version)" ]] || npm install -g npm@$(cat .npm-version) --silent --depth 0'

test:
  override:
    - npm run test:style:
        parallel: true
        files:
          - config/**/*.js
          - src/**/*.{js,jsx}

deployment:
  production:
    branch: master
      commands:
        - echo ${GCLOUD_SERVICE_ACCOUNT} | base64 --decode > ${HOME}/gcloud-key.json
        - gcloud auth activate-service-account --key-file ${HOME}/gcloud-key.json
        - gcloud set project ${GCLOUD_PROJECT}
        - npm run deploy
          environment:
            VARIANT: production
